
–ì–ª–∞–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
python
CAMERA_URL = 'rtsp://admin:admin@192.168.105.8:554/live/main'  # URL –∫–∞–º–µ—Ä—ã
model = YOLO('yolov8n.pt')  # –ú–æ–¥–µ–ª—å YOLO –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏
target_classes = [0]  # –ö–ª–∞—Å—Å "—á–µ–ª–æ–≤–µ–∫" –≤ COCO dataset
1. –ö–ª–∞—Å—Å Camera - –æ—Å–Ω–æ–≤–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
python
class Camera:
    def __init__(self):
        self.cap = cv2.VideoCapture(CAMERA_URL)  # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∫–∞–º–µ—Ä–µ
        self.lock = threading.Lock()  # –ó–∞—â–∏—Ç–∞ –æ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –ø–æ—Ç–æ–∫–æ–≤
        self.heatmap = None  # –¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞
        self.alpha = 0.95  # –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –∑–∞—Ç—É—Ö–∞–Ω–∏—è
2. –§—É–Ω–∫—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã
update_heatmap() - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã
–°–æ–∑–¥–∞–µ—Ç "–≥–æ—Ä—è—á–∏–µ —Ç–æ—á–∫–∏" –≤ –º–µ—Å—Ç–∞—Ö –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ª—é–¥–µ–π

–ü—Ä–∏–º–µ–Ω—è–µ—Ç –≥–∞—É—Å—Å–æ–≤–æ —Ä–∞–∑–º—ã—Ç–∏–µ –≤–æ–∫—Ä—É–≥ —Ü–µ–Ω—Ç—Ä–æ–≤ bounding box'–æ–≤

–î–æ–±–∞–≤–ª—è–µ—Ç —ç—Ñ—Ñ–µ–∫—Ç –∑–∞—Ç—É—Ö–∞–Ω–∏—è —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º

apply_heatmap() - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã
–ù–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç —Ü–≤–µ—Ç–æ–≤—É—é –∫–∞—Ä—Ç—É JET –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–µ –Ω–∞–ª–æ–∂–µ–Ω–∏–µ (70% –æ—Ä–∏–≥–∏–Ω–∞–ª + 30% —Ç–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞)

3. –§—É–Ω–∫—Ü–∏—è –¥–µ—Ç–µ–∫—Ü–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤
detect_objects() - –æ—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –¥–µ—Ç–µ–∫—Ü–∏–∏
python
def detect_objects(self, frame):
    results = model.track(frame, persist=True, verbose=False)  # YOLO —Ç—Ä–µ–∫–∏–Ω–≥
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
    # - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –∫–ª–∞—Å—Å—É "—á–µ–ª–æ–≤–µ–∫" –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ > 0.5
    # - –û—Ç—Ä–∏—Å–æ–≤–∫–∞ bounding boxes —Å ID
    # - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –ª—é–¥–µ–π
4. –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Flask
generate_frames() - –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞
–ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –ø–æ–ª—É—á–µ–Ω–∏—è –∫–∞–¥—Ä–æ–≤

–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ MJPEG –¥–ª—è –±—Ä–∞—É–∑–µ—Ä–∞

–ú–∞—Ä—à—Ä—É—Ç—ã:
/ - HTML —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –≤–∏–¥–µ–æ–ø–ª–µ–µ—Ä–æ–º

/video_feed - –ø–æ—Ç–æ–∫–æ–≤–æ–µ –≤–∏–¥–µ–æ MJPEG

üîß –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
–¢—Ä–µ–∫–∏–Ω–≥ –æ–±—ä–µ–∫—Ç–æ–≤
model.track(persist=True) —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç ID –æ–±—ä–µ–∫—Ç–æ–≤ –º–µ–∂–¥—É –∫–∞–¥—Ä–∞–º–∏

–ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ –ª—é–¥–µ–π

–¢–µ–ø–ª–æ–≤–∞—è –∫–∞—Ä—Ç–∞
–ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ: –ù–æ–≤—ã–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —É—Å–∏–ª–∏–≤–∞—é—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∑–æ–Ω—ã

–ó–∞—Ç—É—Ö–∞–Ω–∏–µ: –°—Ç–∞—Ä—ã–µ –∑–æ–Ω—ã –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ –∏—Å—á–µ–∑–∞—é—Ç (alpha = 0.95)

–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è: –¶–≤–µ—Ç–æ–≤–∞—è –∫–∞—Ä—Ç–∞ JET –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å

–ü–æ—Ç–æ–∫–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
–ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞–º–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ

–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –ø–æ—Ç–µ—Ä–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

üéØ –ß—Ç–æ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å
python
# –ß—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–µ—Ç–µ–∫—Ü–∏–∏
conf_threshold = 0.5  # –¢–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

# –°–∫–æ—Ä–æ—Å—Ç—å –∑–∞—Ç—É—Ö–∞–Ω–∏—è —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã
alpha = 0.95  # –ß–µ–º –±–ª–∏–∂–µ –∫ 1, —Ç–µ–º –¥–æ–ª—å—à–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

# –†–∞–∑–º–µ—Ä "–≥–æ—Ä—è—á–∏—Ö —Ç–æ—á–µ–∫"
circle_radius = 30  # –¢–µ–∫—É—â–∏–π —Ä–∞–¥–∏—É—Å —Ä–∞–∑–º—ã—Ç–∏—è

# –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –Ω–∞–ª–æ–∂–µ–Ω–∏—è
overlay_alpha = 0.3  # –í–∫–ª–∞–¥ —Ç–µ–ø–ª–æ–≤–æ–π –∫–∞—Ä—Ç—ã
–°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é —Å–∏—Å—Ç–µ–º—É –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–µ–π —Å–∫–æ–ø–ª–µ–Ω–∏–π –ª—é–¥–µ–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏!
